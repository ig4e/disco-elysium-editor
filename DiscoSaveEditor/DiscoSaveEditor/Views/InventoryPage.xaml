<Page
    x:Class="DiscoSaveEditor.Views.InventoryPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="using:DiscoSaveEditor.ViewModels">

    <Grid Padding="32,24,32,32" RowSpacing="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Grid Grid.Row="0" ColumnSpacing="12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <TextBlock Text="Inventory" Style="{StaticResource TitleTextBlockStyle}" Grid.Column="0" VerticalAlignment="Center" />
            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
                <TextBlock Text="Bullets:" VerticalAlignment="Center" />
                <NumberBox Value="{x:Bind ViewModel.Bullets, Mode=TwoWay}" Minimum="0" SpinButtonPlacementMode="Compact" Width="110" />
            </StackPanel>
            <Button Grid.Column="2" Content="Add All Items" Command="{x:Bind ViewModel.AddAllItemsCommand}" VerticalAlignment="Center" />
            <Button Grid.Column="3" Content="Remove Non-Quest" Command="{x:Bind ViewModel.RemoveAllItemsCommand}" VerticalAlignment="Center" />
        </Grid>

        <!-- Search -->
        <AutoSuggestBox Grid.Row="1" PlaceholderText="Search owned items..." QueryIcon="Find"
                         Text="{x:Bind ViewModel.SearchQuery, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

        <!-- Two-panel layout: Owned items + Item catalog -->
        <Grid Grid.Row="2" ColumnSpacing="16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="350" />
            </Grid.ColumnDefinitions>

            <!-- Owned Items List -->
            <ListView Grid.Column="0" ItemsSource="{x:Bind ViewModel.OwnedItems}" SelectionMode="None">
                <ListView.Header>
                    <Grid Padding="12,8" Background="{ThemeResource SubtleFillColorSecondaryBrush}" CornerRadius="4" Margin="0,0,0,4">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="200" />
                            <ColumnDefinition Width="80" />
                            <ColumnDefinition Width="100" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="80" />
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Text="Item" FontWeight="SemiBold" />
                        <TextBlock Grid.Column="1" Text="Equipped" FontWeight="SemiBold" />
                        <TextBlock Grid.Column="2" Text="Slot" FontWeight="SemiBold" />
                        <TextBlock Grid.Column="3" Text="Bonus" FontWeight="SemiBold" />
                        <TextBlock Grid.Column="4" Text="Actions" FontWeight="SemiBold" />
                    </Grid>
                </ListView.Header>
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="vm:InventoryDisplayItem">
                        <Grid Padding="12,6" ColumnSpacing="8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="200" />
                                <ColumnDefinition Width="80" />
                                <ColumnDefinition Width="100" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="80" />
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0">
                                <TextBlock Text="{x:Bind DisplayName}" FontWeight="SemiBold" />
                                <TextBlock Text="{x:Bind Name}" FontSize="10" 
                                           Foreground="{ThemeResource TextFillColorTertiaryBrush}" />
                            </StackPanel>

                            <CheckBox Grid.Column="1" IsChecked="{x:Bind IsEquipped, Mode=TwoWay}" 
                                      VerticalAlignment="Center" />

                            <TextBlock Grid.Column="2" Text="{x:Bind EquipSlot}" 
                                       VerticalAlignment="Center" FontSize="12" />

                            <TextBlock Grid.Column="3" Text="{x:Bind Bonus}" FontSize="12"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                       TextTrimming="CharacterEllipsis" VerticalAlignment="Center" />

                            <Button Grid.Column="4" Content="Remove" VerticalAlignment="Center"
                                    Style="{StaticResource DefaultButtonStyle}" Padding="8,4" FontSize="11"
                                    Tag="{x:Bind}"
                                    Click="RemoveItem_Click" />
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>

            <!-- Item Catalog (browsable add panel) -->
            <Border Grid.Column="1" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1" CornerRadius="8" Padding="12">
                <Grid RowSpacing="8">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0" Text="Item Catalog" FontWeight="SemiBold" FontSize="14" />
                    <AutoSuggestBox Grid.Row="1" PlaceholderText="Search catalog..." QueryIcon="Find"
                                     Text="{x:Bind ViewModel.CatalogSearchQuery, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                    <ListView Grid.Row="2" ItemsSource="{x:Bind ViewModel.FilteredCatalog}" SelectionMode="None">
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="vm:InventoryDisplayItem">
                                <Grid Padding="4,6" ColumnSpacing="8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="{x:Bind DisplayName}" FontSize="12" FontWeight="SemiBold" />
                                        <TextBlock Text="{x:Bind Bonus}" FontSize="10" MaxLines="1"
                                                   Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                                   TextTrimming="CharacterEllipsis" />
                                    </StackPanel>
                                    <Button Grid.Column="1" Content="Add" Padding="8,2" FontSize="11"
                                            Tag="{x:Bind}"
                                            Click="AddItem_Click" />
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Page>
