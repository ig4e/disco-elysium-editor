<Window
    x:Class="DiscoSaveEditor.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:DiscoSaveEditor"
    xmlns:vm="using:DiscoSaveEditor.ViewModels"
    Title="Disco Elysium Save Editor">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <NavigationView x:Name="NavView" Grid.Row="0"
                        PaneDisplayMode="Left"
                        IsSettingsVisible="False"
                        IsBackButtonVisible="Collapsed"
                        SelectionChanged="NavView_SelectionChanged"
                        IsEnabled="{x:Bind ViewModel.IsSaveLoaded, Mode=OneWay}">

            <NavigationView.MenuItems>
                <NavigationViewItem Content="Character" Tag="Character">
                    <NavigationViewItem.Icon><FontIcon Glyph="&#xE77B;" /></NavigationViewItem.Icon>
                </NavigationViewItem>
                <NavigationViewItem Content="Inventory" Tag="Inventory">
                    <NavigationViewItem.Icon><FontIcon Glyph="&#xE719;" /></NavigationViewItem.Icon>
                </NavigationViewItem>
                <NavigationViewItem Content="Thought Cabinet" Tag="ThoughtCabinet">
                    <NavigationViewItem.Icon><FontIcon Glyph="&#xE8BD;" /></NavigationViewItem.Icon>
                </NavigationViewItem>
                <NavigationViewItem Content="Journal" Tag="Journal">
                    <NavigationViewItem.Icon><FontIcon Glyph="&#xE736;" /></NavigationViewItem.Icon>
                </NavigationViewItem>
                <NavigationViewItem Content="Party" Tag="Party">
                    <NavigationViewItem.Icon><FontIcon Glyph="&#xE716;" /></NavigationViewItem.Icon>
                </NavigationViewItem>
                <NavigationViewItem Content="World" Tag="World">
                    <NavigationViewItem.Icon><FontIcon Glyph="&#xE909;" /></NavigationViewItem.Icon>
                </NavigationViewItem>
                <NavigationViewItem Content="White Checks" Tag="WhiteChecks">
                    <NavigationViewItem.Icon><FontIcon Glyph="&#xE7C1;" /></NavigationViewItem.Icon>
                </NavigationViewItem>
                <NavigationViewItem Content="Containers" Tag="Containers">
                    <NavigationViewItem.Icon><FontIcon Glyph="&#xE7B8;" /></NavigationViewItem.Icon>
                </NavigationViewItem>
                <NavigationViewItem Content="States" Tag="States">
                    <NavigationViewItem.Icon><FontIcon Glyph="&#xE8B7;" /></NavigationViewItem.Icon>
                </NavigationViewItem>
            </NavigationView.MenuItems>

            <NavigationView.PaneFooter>
                <StackPanel Padding="12" Spacing="6">
                    <!-- Undo/Redo buttons -->
                    <Grid ColumnSpacing="6">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Button Grid.Column="0" Content="&#xE7A7;" FontFamily="Segoe MDL2 Assets" 
                                ToolTipService.ToolTip="Undo"
                                HorizontalAlignment="Stretch"
                                Command="{x:Bind ViewModel.UndoCommand}"
                                IsEnabled="{x:Bind ViewModel.UndoRedo.CanUndo, Mode=OneWay}" />
                        <Button Grid.Column="1" Content="&#xE7A6;" FontFamily="Segoe MDL2 Assets"
                                ToolTipService.ToolTip="Redo"
                                HorizontalAlignment="Stretch"
                                Command="{x:Bind ViewModel.RedoCommand}"
                                IsEnabled="{x:Bind ViewModel.UndoRedo.CanRedo, Mode=OneWay}" />
                    </Grid>
                    
                    <Button Content="&#xE838; Open Save Folder" FontFamily="Segoe MDL2 Assets,Segoe UI"
                            HorizontalAlignment="Stretch" Command="{x:Bind ViewModel.OpenSaveCommand}" />
                    <Button Content="&#xE74E; Save Changes" FontFamily="Segoe MDL2 Assets,Segoe UI"
                            HorizontalAlignment="Stretch" Style="{StaticResource AccentButtonStyle}"
                            Command="{x:Bind ViewModel.SaveCommand}"
                            IsEnabled="{x:Bind ViewModel.IsSaveLoaded, Mode=OneWay}" />
                    <Button Content="&#xE792; Save As..." FontFamily="Segoe MDL2 Assets,Segoe UI"
                            HorizontalAlignment="Stretch"
                            Command="{x:Bind ViewModel.SaveAsCommand}"
                            IsEnabled="{x:Bind ViewModel.IsSaveLoaded, Mode=OneWay}" />
                    <Button Content="&#xE72C; Refresh Saves" FontFamily="Segoe MDL2 Assets,Segoe UI"
                            HorizontalAlignment="Stretch"
                            Command="{x:Bind ViewModel.RefreshDiscoveredSavesCommand}" />
                </StackPanel>
            </NavigationView.PaneFooter>

            <Grid>
                <!-- Content frame for pages -->
                <Frame x:Name="ContentFrame" />

                <!-- Welcome / Save Picker overlay shown when no save is loaded -->
                <Grid x:Name="WelcomeOverlay" 
                      Visibility="{x:Bind ViewModel.ShowWelcome, Mode=OneWay}"
                      Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
                    <ScrollViewer HorizontalAlignment="Center" VerticalAlignment="Center" MaxWidth="600">
                        <StackPanel Spacing="20" Padding="40" HorizontalAlignment="Center">
                            <TextBlock Text="Disco Elysium Save Editor" 
                                       Style="{StaticResource TitleLargeTextBlockStyle}"
                                       HorizontalAlignment="Center" />
                            <TextBlock Text="Select a discovered save below, or open a save folder manually."
                                       Style="{StaticResource BodyTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                       HorizontalAlignment="Center" TextAlignment="Center" />

                            <ListView ItemsSource="{x:Bind ViewModel.RecentSaves}"
                                      SelectionMode="Single"
                                      SelectionChanged="SaveList_SelectionChanged"
                                      MaxHeight="400">
                                <ListView.ItemTemplate>
                                    <DataTemplate x:DataType="vm:RecentSaveItem">
                                        <Grid Padding="8,12" ColumnSpacing="12">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>
                                            <FontIcon Grid.Column="0" Glyph="&#xE8B7;" 
                                                      Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                                      VerticalAlignment="Center" />
                                            <StackPanel Grid.Column="1">
                                                <TextBlock Text="{x:Bind DisplayName}" FontWeight="SemiBold" />
                                                <TextBlock Text="{x:Bind Path}" FontSize="11"
                                                           Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                                           TextTrimming="CharacterEllipsis" MaxLines="1" />
                                            </StackPanel>
                                            <TextBlock Grid.Column="2" Text="{x:Bind LastModifiedText}" 
                                                       FontSize="11"
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                       VerticalAlignment="Center" />
                                        </Grid>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>

                            <Button Content="Open Save Folder Manually..."
                                    HorizontalAlignment="Center"
                                    Command="{x:Bind ViewModel.OpenSaveCommand}" />
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </Grid>
        </NavigationView>

        <!-- Status Bar -->
        <Grid Grid.Row="1" Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}" 
              Padding="16,6" ColumnSpacing="16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <TextBlock Grid.Column="0" Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}" 
                       FontSize="12" VerticalAlignment="Center"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
            <TextBlock Grid.Column="1" Text="{x:Bind ViewModel.SaveDisplayName, Mode=OneWay}" 
                       FontSize="12" FontWeight="SemiBold" VerticalAlignment="Center" />
            <ProgressRing Grid.Column="2" IsActive="{x:Bind ViewModel.IsBusy, Mode=OneWay}" 
                          Width="16" Height="16" />
        </Grid>
    </Grid>
</Window>
